# AI Manifest Display - Architecture Diagram

**Visual reference for component integration and data flow**

---

## Component Hierarchy

```
AdminDashboard.tsx (Main Container)
  â””â”€ Document Viewer Modal (lines 1836-2039)
      â””â”€ Loads List (foreach load)
          â””â”€ Documents List (foreach document)
              â”œâ”€ Document Header
              â”‚   â”œâ”€ Filename
              â”‚   â”œâ”€ Document Type
              â”‚   â”œâ”€ Upload Date
              â”‚   â””â”€ "View" Button
              â”‚
              â””â”€ ManifestDataDisplay.tsx (NEW)
                  â”œâ”€ Data Quality Badge
                  â”œâ”€ Summary Cards (3-column grid)
                  â”‚   â”œâ”€ Total Joints
                  â”‚   â”œâ”€ Total Length (ft)
                  â”‚   â””â”€ Total Weight (lbs)
                  â”œâ”€ Data Table (9 columns, scrollable)
                  â”‚   â”œâ”€ Index
                  â”‚   â”œâ”€ Manufacturer
                  â”‚   â”œâ”€ Heat Number
                  â”‚   â”œâ”€ Serial Number
                  â”‚   â”œâ”€ Quantity
                  â”‚   â”œâ”€ Tally Length (ft)
                  â”‚   â”œâ”€ Grade
                  â”‚   â”œâ”€ Outer Diameter (in)
                  â”‚   â””â”€ Weight (lbs/ft)
                  â””â”€ Info Box (AI extraction disclaimer)
```

---

## Data Flow Sequence

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. CUSTOMER UPLOAD (InboundShipmentWizard.tsx)                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. AI EXTRACTION (manifestProcessingService.ts)                â”‚
â”‚    - Google Gemini Vision API                                  â”‚
â”‚    - Returns ManifestItem[]                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. STORAGE (Supabase)                                          â”‚
â”‚    - File â†’ supabase.storage (bucket: trucking-documents)      â”‚
â”‚    - Record â†’ trucking_documents table                          â”‚
â”‚      {                                                          â”‚
â”‚        id, trucking_load_id, file_name, storage_path,          â”‚
â”‚        document_type, uploaded_by, uploaded_at,                â”‚
â”‚        parsed_payload: ManifestItem[] â† NEW                     â”‚
â”‚      }                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. ADMIN QUERY (useSupabaseData.ts)                            â”‚
â”‚    SELECT *,                                                    â”‚
â”‚      trucking_loads(                                            â”‚
â”‚        *,                                                       â”‚
â”‚        trucking_documents(*)  â† Includes parsed_payload         â”‚
â”‚      )                                                          â”‚
â”‚    FROM storage_requests                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 5. DATA MAPPING (mapTruckingDocumentRow)                       â”‚
â”‚    row.parsed_payload â†’ document.parsedPayload                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 6. COMPONENT RENDER (ManifestDataDisplay.tsx)                  â”‚
â”‚    - Check if data exists (null/empty handling)                â”‚
â”‚    - Calculate quality metrics (completeness %)                 â”‚
â”‚    - Calculate totals (joints, length, weight)                  â”‚
â”‚    - Render table or placeholder message                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Database Schema

```sql
-- BEFORE (Existing)
trucking_documents
â”œâ”€ id (uuid, PK)
â”œâ”€ trucking_load_id (uuid, FK)
â”œâ”€ file_name (text)
â”œâ”€ storage_path (text)
â”œâ”€ document_type (text, nullable)
â”œâ”€ uploaded_by (text, nullable)
â””â”€ uploaded_at (timestamptz)

-- AFTER (Migration 20251107000002)
trucking_documents
â”œâ”€ id (uuid, PK)
â”œâ”€ trucking_load_id (uuid, FK)
â”œâ”€ file_name (text)
â”œâ”€ storage_path (text)
â”œâ”€ document_type (text, nullable)
â”œâ”€ uploaded_by (text, nullable)
â”œâ”€ uploaded_at (timestamptz)
â””â”€ parsed_payload (jsonb, nullable) â† NEW
    â””â”€ Array of ManifestItem:
        {
          manufacturer: string | null,
          heat_number: string | null,
          serial_number: string | null,
          tally_length_ft: number | null,
          quantity: number,
          grade: string | null,
          outer_diameter: number | null,
          weight_lbs_ft: number | null
        }[]
```

---

## TypeScript Type Hierarchy

```typescript
// types.ts
StorageRequest
  â””â”€ truckingLoads?: TruckingLoad[]
      â””â”€ documents?: TruckingDocument[]
          â””â”€ parsedPayload?: ManifestItem[] | null â† NEW
              â””â”€ ManifestItem {
                  manufacturer: string | null;
                  heat_number: string | null;
                  serial_number: string | null;
                  tally_length_ft: number | null;
                  quantity: number;
                  grade: string | null;
                  outer_diameter: number | null;
                  weight_lbs_ft: number | null;
                }
```

---

## UI Layout (Before vs After)

### BEFORE:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Document Viewer Modal                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Request ABC-123                                â”‚
â”‚ 3 trucking loads tracked                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ [Direction â–¼] [Status â–¼] [Search...] [Reset]  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                 â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚ â”‚ Truck to MPS - Load 1                      â”‚â”‚
â”‚ â”‚ Status: NEW                                 â”‚â”‚
â”‚ â”‚                                             â”‚â”‚
â”‚ â”‚ 2 documents                    [Edit] [Del] â”‚â”‚
â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤â”‚
â”‚ â”‚ â€¢ manifest.pdf                              â”‚â”‚
â”‚ â”‚   Manifest - Nov 7, 2025 @ 8:30 AM  [View] â”‚â”‚
â”‚ â”‚                                             â”‚â”‚
â”‚ â”‚ â€¢ pod.jpg                                   â”‚â”‚
â”‚ â”‚   Proof of Delivery - Nov 7 @ 2:15 PM [View]â”‚â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### AFTER:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Document Viewer Modal                                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Request ABC-123                                             â”‚
â”‚ 3 trucking loads tracked                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ [Direction â–¼] [Status â–¼] [Search...] [Reset]               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚ â”‚ Truck to MPS - Load 1                                   â”‚â”‚
â”‚ â”‚ Status: NEW                                              â”‚â”‚
â”‚ â”‚                                                          â”‚â”‚
â”‚ â”‚ 2 documents                             [Edit] [Delete] â”‚â”‚
â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤â”‚
â”‚ â”‚ â€¢ manifest.pdf                                           â”‚â”‚
â”‚ â”‚   Manifest - Nov 7, 2025 @ 8:30 AM               [View] â”‚â”‚
â”‚ â”‚                                                          â”‚â”‚
â”‚ â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚â”‚
â”‚ â”‚   â”‚ ğŸ¤– AI-EXTRACTED MANIFEST DATA  [90% Complete âœ“]   â”‚â”‚â”‚
â”‚ â”‚   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤â”‚â”‚
â”‚ â”‚   â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚â”‚â”‚
â”‚ â”‚   â”‚ â”‚ 100      â”‚ â”‚ 3,120 ft â”‚ â”‚ 72,000   â”‚           â”‚â”‚â”‚
â”‚ â”‚   â”‚ â”‚ Joints   â”‚ â”‚          â”‚ â”‚ lbs      â”‚           â”‚â”‚â”‚
â”‚ â”‚   â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚â”‚â”‚
â”‚ â”‚   â”‚                                                    â”‚â”‚â”‚
â”‚ â”‚   â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚â”‚â”‚
â”‚ â”‚   â”‚ â”‚ # â”‚ Mfr     â”‚ Heat  â”‚ Serial â”‚ ... â”‚ Grade â”‚  â”‚â”‚â”‚â”‚
â”‚ â”‚   â”‚ â”œâ”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚â”‚â”‚â”‚
â”‚ â”‚   â”‚ â”‚ 1 â”‚ Tenaris â”‚ H1234 â”‚ TNS-01 â”‚ ... â”‚  L80  â”‚  â”‚â”‚â”‚â”‚
â”‚ â”‚   â”‚ â”‚ 2 â”‚ Tenaris â”‚ H1235 â”‚ TNS-02 â”‚ ... â”‚  L80  â”‚  â”‚â”‚â”‚â”‚
â”‚ â”‚   â”‚ â”‚...â”‚   ...   â”‚  ...  â”‚  ...   â”‚ ... â”‚  ...  â”‚  â”‚â”‚â”‚â”‚
â”‚ â”‚   â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚â”‚â”‚
â”‚ â”‚   â”‚                                                    â”‚â”‚â”‚
â”‚ â”‚   â”‚ â„¹ï¸ AI-extracted from manifest.pdf                 â”‚â”‚â”‚
â”‚ â”‚   â”‚   Please verify accuracy before critical ops.     â”‚â”‚â”‚
â”‚ â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚â”‚
â”‚ â”‚                                                          â”‚â”‚
â”‚ â”‚ â€¢ pod.jpg                                                â”‚â”‚
â”‚ â”‚   Proof of Delivery - Nov 7 @ 2:15 PM            [View] â”‚â”‚
â”‚ â”‚                                                          â”‚â”‚
â”‚ â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚â”‚
â”‚ â”‚   â”‚ ğŸ“„ No manifest data extracted from this document   â”‚â”‚â”‚
â”‚ â”‚   â”‚    This may be a proof of delivery, photos, or     â”‚â”‚â”‚
â”‚ â”‚   â”‚    other non-manifest document.                    â”‚â”‚â”‚
â”‚ â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## State Transitions

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Document Upload â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”      YES      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Is PDF/ â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ â”‚ AI Extraction  â”‚
    â”‚ Image?  â”‚               â”‚ (Gemini Vision)â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                              â”‚
         â”‚ NO                           â–¼
         â”‚                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚                     â”‚ ManifestItem[]   â”‚
         â”‚                     â”‚ extracted        â”‚
         â”‚                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                              â”‚
         â–¼                              â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Save to Database                           â”‚
    â”‚ parsed_payload = ManifestItem[] OR null    â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Admin Views Document                       â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚                       â”‚
         â–¼                       â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ parsedPayloadâ”‚         â”‚ parsedPayloadâ”‚
  â”‚ exists?      â”‚         â”‚ = null/empty?â”‚
  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                       â”‚
         â–¼                       â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ Show table  â”‚         â”‚ Show "No data"â”‚
  â”‚ with data   â”‚         â”‚ placeholder   â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Quality Metrics Calculation

```typescript
// Input: ManifestItem[]
const data = [
  { manufacturer: "Tenaris", heat_number: "H1234", serial_number: "TNS-01", ... },
  { manufacturer: "Tenaris", heat_number: null, serial_number: "TNS-02", ... },
  { manufacturer: null, heat_number: "H1236", serial_number: null, ... },
];

// Calculation:
qualityMetrics = {
  withHeatNumber: 2,        // Items with heat_number != null
  withSerialNumber: 2,      // Items with serial_number != null
  withLength: 3,            // Items with tally_length_ft != null
  withGrade: 3,             // Items with grade != null
  total: 3                  // Total items
};

completeness = (2 + 2 + 3 + 3) / (3 * 4) * 100
             = 10 / 12 * 100
             = 83% (Yellow badge)

// Color mapping:
90-100%: Green (bg-green-900/30)
70-89%:  Yellow (bg-yellow-900/30)
0-69%:   Red (bg-red-900/30)
```

---

## Totals Calculation

```typescript
// Input: ManifestItem[]
const data = [
  { quantity: 1, tally_length_ft: 31.2, weight_lbs_ft: 23.0 },
  { quantity: 1, tally_length_ft: 31.5, weight_lbs_ft: 23.0 },
  { quantity: 1, tally_length_ft: 31.0, weight_lbs_ft: 23.0 },
];

// Calculation:
totals = data.reduce((acc, item) => {
  const qty = item.quantity || 0;          // 1
  const lengthFt = item.tally_length_ft || 0; // 31.2
  const weightPerFoot = item.weight_lbs_ft || 0; // 23.0

  return {
    joints: acc.joints + qty,                        // 1 + 1 + 1 = 3
    lengthFt: acc.lengthFt + (lengthFt * qty),      // 31.2 + 31.5 + 31.0 = 93.7
    weightLbs: acc.weightLbs + (lengthFt * qty * weightPerFoot) // (31.2*23) + (31.5*23) + (31.0*23) = 2,155 lbs
  };
}, { joints: 0, lengthFt: 0, weightLbs: 0 });

// Result:
totals = {
  joints: 3,
  lengthFt: 93.7,
  weightLbs: 2155
};
```

---

## Error Handling Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ document.parsedPayload â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”
    â”‚             â”‚
    â–¼             â–¼
  null         []         ManifestItem[]
    â”‚           â”‚              â”‚
    â”‚           â”‚              â”‚
    â–¼           â–¼              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ if (!data || data.length === 0)    â”‚
â”‚   return <NoDataPlaceholder />     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â–¼
           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â”‚ Calculate      â”‚
           â”‚ - Quality      â”‚
           â”‚ - Totals       â”‚
           â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â–¼
           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â”‚ Render Table   â”‚
           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## File Dependency Graph

```
AdminDashboard.tsx (Modified)
  â””â”€ imports ManifestDataDisplay.tsx (New)
      â””â”€ uses ManifestItem interface
          â””â”€ defined in types.ts (Modified)

useSupabaseData.ts (Modified)
  â””â”€ mapTruckingDocumentRow() updated
      â””â”€ includes parsed_payload field
          â””â”€ from database column (Migration)

Database (Modified via Migration)
  â””â”€ trucking_documents table
      â””â”€ parsed_payload column (JSONB)
          â””â”€ populated by manifestProcessingService.ts
              â””â”€ (No changes needed - already returns ManifestItem[])
```

---

## Performance Characteristics

| Operation | Time Complexity | Space Complexity | Notes |
|-----------|----------------|------------------|-------|
| Data fetch | O(n) | O(n) | n = number of documents, no additional queries |
| Quality calc | O(m) | O(1) | m = number of joints in manifest |
| Totals calc | O(m) | O(1) | Single reduce pass |
| Table render | O(m) | O(m) | React virtual DOM |

**Typical Manifest**:
- 50-100 joints: ~5-10 KB JSON
- Calculation: <10ms
- Render: <50ms

**Large Manifest**:
- 200+ joints: ~20-40 KB JSON
- Calculation: <20ms
- Render: <100ms (virtualization not needed)

---

## Browser Compatibility Matrix

| Browser | Version | Status | Notes |
|---------|---------|--------|-------|
| Chrome | 120+ | âœ… Full | Primary development browser |
| Firefox | 120+ | âœ… Full | CSS Grid, Flexbox support |
| Edge | 120+ | âœ… Full | Chromium-based |
| Safari | 16+ | âœ… Full | Webkit rendering |
| Mobile Chrome | Latest | âœ… Responsive | Touch-friendly scrolling |
| Mobile Safari | Latest | âœ… Responsive | iOS 15+ |

**CSS Features Used**:
- CSS Grid (for summary cards)
- Flexbox (for layouts)
- Sticky positioning (table header)
- Custom scrollbars (webkit)

---

**Last Updated**: 2025-11-07
**Diagram Version**: 1.0
